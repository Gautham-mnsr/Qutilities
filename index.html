<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Translator, Calculator, Map </title>
  <!-- Google Fonts: Poppins -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/[email protected]/dist/leaflet.css" />
  <style>
    :root {
      --bg: #f7f9fc;
      --card-bg: #ffffff;
      --primary: #4e89ae;
      --primary-light: #6ab7ff;
      --secondary: #ffa372;
      --accent: #ed6663;
      --text: #2d3436;
      --border: #dfe6e9;
      --button: #4e89ae;
      --button-hover: #3a6b8a;
      --shadow: rgba(0, 0, 0, 0.1);
      --menu-bg: #4e89ae;
      --menu-hover: #3a6b8a;
      --menu-text: #fff;
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Poppins', sans-serif;
      font-weight: 400;
      font-size: 16px;
      line-height: 1.7;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }
    header {
      background: var(--menu-bg);
      color: var(--menu-text);
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .menu {
      display: flex;
      justify-content: center;
      gap: 1rem;
      list-style: none;
      flex-wrap: wrap;
      font-weight: 500;
      font-size: 1.1rem;
    }
    .menu li a {
      color: var(--menu-text);
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      transition: background 0.2s;
    }
    .menu li a:hover {
      background: var(--menu-hover);
    }
    .menu li a.active {
      background: var(--menu-hover);
      font-weight: 600;
    }
    .container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--primary);
      font-weight: 600;
      font-size: 2rem;
      line-height: 1.2;
    }
    .app-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin: 0 auto;
    }
    .card, .calculator-card, .map-card, .poem-card {
      background: var(--card-bg);
      padding: 2rem;
      border-radius: 12px;
      box-shadow: 0 8px 16px var(--shadow);
      transition: transform 0.2s;
    }
    .card:hover, .calculator-card:hover, .map-card:hover, .poem-card:hover {
      transform: translateY(-4px);
    }
    label {
      font-weight: 500;
      color: var(--primary);
      margin-bottom: 0.5rem;
      display: block;
      font-size: 1.1rem;
    }
    textarea, input[type="text"] {
      width: calc(100% - 3rem);
      font-family: 'Poppins', sans-serif;
      font-size: 1rem;
      padding: 0.8rem;
      margin-bottom: 0.5rem;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: #f8fafc;
      transition: border-color 0.2s;
    }
    textarea:focus, input[type="text"]:focus {
      border-color: var(--primary-light);
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 100px;
    }
    #display {
      width: 100%;
      font-size: 1.5rem;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 2px solid var(--border);
      border-radius: 8px;
      background: #f8fafc;
      text-align: right;
      font-family: 'Poppins', sans-serif;
    }
    #keys {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
    }
    button {
      font-family: 'Poppins', sans-serif;
      font-size: 1.2rem;
      font-weight: 500;
      padding: 1rem;
      border: none;
      border-radius: 8px;
      background: var(--button);
      color: white;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    button:hover {
      background: var(--button-hover);
      transform: translateY(-2px);
    }
    button:active {
      transform: translateY(0);
    }
    #map-container {
      width: 100%;
      height: 400px;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    #poem-analysis-result {
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      background: #f0f8ff;
      border: 1px solid var(--border);
      font-family: 'Poppins', sans-serif;
      line-height: 1.6;
    }
    .voice-btn {
      margin: 0;
      padding: 0.5rem;
      border-radius: 50%;
      width: 2.5rem;
      height: 2.5rem;
      background: var(--button);
      color: white;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: 'Poppins', sans-serif;
      font-size: 1.2rem;
    }
    .voice-btn:hover {
      background: var(--button-hover);
    }
    .input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.5rem;
    }
    @media (max-width: 768px) {
      .app-grid {
        grid-template-columns: 1fr;
      }
      .card, .calculator-card, .map-card, .poem-card {
        margin-bottom: 2rem;
      }
      .menu {
        flex-direction: column;
        align-items: center;
      }
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <nav>
      <ul class="menu">
        <li><a href="#" class="active" data-section="translator">Translator</a></li>
        <li><a href="#" data-section="calculator">Calculator</a></li>
        <li><a href="#" data-section="map">Map</a></li>
       
      </ul>
    </nav>
  </header>

  <div class="container">
    <h2>Translator | Calculator | Map </h2>
    <div id="translator" class="section active">
      <div class="card">
        <label for="englishText">English:</label>
        <div class="input-group">
          <textarea id="englishText" placeholder="Type English here..."></textarea>
          <button class="voice-btn" onclick="listen('englishText')">🎤</button>
          <button class="voice-btn" onclick="speak('englishText')">🔊</button>
        </div>
        <label for="malayalamText">Malayalam:</label>
        <div class="input-group">
          <textarea id="malayalamText" placeholder="ഇവിടെ മലയാളം എഴുതൂ..."></textarea>
          <button class="voice-btn" onclick="listen('malayalamText')">🎤</button>
          <button class="voice-btn" onclick="speak('malayalamText')">🔊</button>
        </div>
        <label for="hindiText">Hindi:</label>
        <div class="input-group">
          <textarea id="hindiText" placeholder="यहाँ हिंदी लिखें..."></textarea>
          <button class="voice-btn" onclick="listen('hindiText')">🎤</button>
          <button class="voice-btn" onclick="speak('hindiText')">🔊</button>
        </div>
      </div>
    </div>
    <div id="calculator" class="section">
      <div class="calculator-card">
        <input type="text" id="display" readonly>
        <div id="keys">
          <button onclick="appendToDisplay('7')">7</button>
          <button onclick="appendToDisplay('8')">8</button>
          <button onclick="appendToDisplay('9')">9</button>
          <button onclick="appendToDisplay('+')">+</button>
          <button onclick="appendToDisplay('4')">4</button>
          <button onclick="appendToDisplay('5')">5</button>
          <button onclick="appendToDisplay('6')">6</button>
          <button onclick="appendToDisplay('-')">-</button>
          <button onclick="appendToDisplay('1')">1</button>
          <button onclick="appendToDisplay('2')">2</button>
          <button onclick="appendToDisplay('3')">3</button>
          <button onclick="appendToDisplay('*')">*</button>
          <button onclick="appendToDisplay('0')">0</button>
          <button onclick="appendToDisplay('.')">.</button>
          <button onclick="clearDisplay()">C</button>
          <button onclick="calculate()">=</button>
          <button onclick="appendToDisplay('/')">/</button>
        </div>
      </div>
    </div>
    <div id="map" class="section">
      <div class="map-card">
        <input type="text" id="place-input" placeholder="Enter place name">
        <button onclick="searchPlace()">Show on Map</button>
        <div id="map-container"></div>
      </div>
    </div>
    <div id="poem" class="section">
      <div class="poem-card">
        <label for="poem-text">Paste your English poem:</label>
        <div class="input-group">
          <textarea id="poem-text" placeholder="Paste your poem here (20-700 words)"></textarea>
          <button class="voice-btn" onclick="listen('poem-text')">🎤</button>
          <button class="voice-btn" onclick="speak('poem-text')">🔊</button>
        </div>
        <label for="poem-questions">Your questions about the poem (optional):</label>
        <div class="input-group">
          <textarea id="poem-questions" placeholder="Enter your questions here"></textarea>
          <button class="voice-btn" onclick="listen('poem-questions')">🎤</button>
          <button class="voice-btn" onclick="speak('poem-questions')">🔊</button>
        </div>
        <button onclick="analyzePoemWithPyTorch()">Analyze Poem with PyTorch</button>
        <div id="poem-analysis-result"></div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/[email protected]/dist/leaflet.js"></script>
  <script>
    // --- MENU NAVIGATION ---
    document.querySelectorAll('.menu a').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.menu a').forEach(a => a.classList.remove('active'));
        this.classList.add('active');
        document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
        document.getElementById(this.dataset.section).classList.add('active');
      });
    });

    // --- TRANSLATOR LOGIC ---
    let timeoutEng, timeoutMal, timeoutHin;
    let isTranslating = false;

    document.getElementById('englishText').addEventListener('input', function() {
      if (isTranslating) return;
      clearTimeout(timeoutEng);
      timeoutEng = setTimeout(() => {
        translate('en', 'ml', 'englishText', 'malayalamText');
        translate('en', 'hi', 'englishText', 'hindiText');
      }, 400);
    });

    document.getElementById('malayalamText').addEventListener('input', function() {
      if (isTranslating) return;
      clearTimeout(timeoutMal);
      timeoutMal = setTimeout(() => {
        translate('ml', 'en', 'malayalamText', 'englishText');
      }, 400);
    });

    document.getElementById('hindiText').addEventListener('input', function() {
      if (isTranslating) return;
      clearTimeout(timeoutHin);
      timeoutHin = setTimeout(() => {
        translate('hi', 'en', 'hindiText', 'englishText');
      }, 400);
    });

    async function translate(from, to, inputId, outputId) {
      isTranslating = true;
      const text = document.getElementById(inputId).value;
      if (!text) {
        document.getElementById(outputId).value = '';
        isTranslating = false;
        return;
      }
      const url = `https://translate.googleapis.com/translate_a/single?client=gtx&sl=${from}&tl=${to}&dt=t&q=${encodeURIComponent(text)}`;
      try {
        const response = await fetch(url);
        const result = await response.json();
        document.getElementById(outputId).value = result[0][0][0];
      } catch (e) {
        document.getElementById(outputId).value = 'Error translating!';
      }
      isTranslating = false;
    }

    // --- CALCULATOR LOGIC ---
    let display = document.getElementById('display');
    function appendToDisplay(value) {
      display.value += value;
    }
    function clearDisplay() {
      display.value = '';
    }
    function calculate() {
      try {
        display.value = eval(display.value);
      } catch {
        display.value = 'Error';
      }
    }

    // --- MAP LOGIC ---
    let map, marker;
    function initMap() {
      map = L.map('map-container').setView([20, 77], 5);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);
    }
    initMap();

    async function searchPlace() {
      const query = document.getElementById('place-input').value;
      if (!query) return;
      const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
      const data = await response.json();
      if (data.length > 0) {
        const lat = parseFloat(data[0].lat);
        const lon = parseFloat(data[0].lon);
        if (marker) map.removeLayer(marker);
        marker = L.marker([lat, lon]).addTo(map);
        map.setView([lat, lon], 14);
      } else {
        alert('Place not found!');
      }
    }

    // --- POEM ANALYZER WITH PYTORCH (BACKEND EXAMPLE) ---
    async function analyzePoemWithPyTorch() {
      const poemText = document.getElementById('poem-text').value;
      const poemQuestions = document.getElementById('poem-questions').value;
      const resultDiv = document.getElementById('poem-analysis-result');

      if (!poemText) {
        resultDiv.innerHTML = '<p>Please paste a poem to analyze.</p>';
        return;
      }

      resultDiv.innerHTML = '<p>Analyzing poem with PyTorch backend...</p>';

      // In production, call your PyTorch backend API
      try {
        const response = await fetch('/api/pytorch-analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            poem: poemText,
            questions: poemQuestions
          })
        });

        if (!response.ok) {
          throw new Error('Failed to call PyTorch backend: ' + response.statusText);
        }

        const data = await response.json();
        // Example response: { "analysis": "..." }
        resultDiv.innerHTML = `
          <h3>Poem Analysis with PyTorch</h3>
          <p>${data.analysis ? data.analysis.replace(/\n/g, '<br>') : 'No analysis received.'}</p>
        `;
      } catch (error) {
        resultDiv.innerHTML = `<p>Error: ${error.message}.<br>Make sure your backend is running and accessible.</p>`;
      }
    }

    // --- VOICE ASSISTANT LOGIC ---
    let listening = false;
    let currentInputId = '';

    function listen(inputId) {
      if (listening) {
        alert('Already listening!');
        return;
      }
      currentInputId = inputId;
      listening = true;
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        alert('Speech recognition not supported in your browser.');
        listening = false;
        return;
      }
      const recognition = new SpeechRecognition();
      recognition.lang = 'en-US'; // Change language as needed
      recognition.interimResults = false;
      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById(inputId).value = transcript;
        listening = false;
      };
      recognition.onerror = function(event) {
        alert('Error: ' + event.error);
        listening = false;
      };
      recognition.start();
    }

    function speak(inputId) {
      const text = document.getElementById(inputId).value;
      if (!text) {
        alert('No text to speak.');
        return;
      }
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US'; // Change language as needed
      window.speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
